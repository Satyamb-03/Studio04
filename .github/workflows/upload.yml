- name: Deploy to Server
  uses: appleboy/ssh-action@v0.1.4
  with:
    host: 95.111.219.120  # Replace with the server's IP address
    username: satyam  # SSH username
    password: ${{ secrets.SERVER_PASSWORD }}  # Secret for SSH password
    script: |
      set -e
      echo "Checking if Docker is installed on the server..."
      if ! [ -x "$(command -v docker)" ]; then
        echo "Docker is not installed. Installing Docker..."
        sudo apt update && sudo apt install -y docker.io
      fi
      echo "Docker is installed and ready."
      
      echo "Navigating to Photography-App directory..."
      cd Photography-App || {
        echo "Folder not found. Cloning private repository.";
        git clone https://${{ secrets.GH_PAT }}@github.com/<your-username>/<your-repo>.git Photography-App && cd Photography-App;
      }

      echo "Pulling the latest changes from the repository..."
      git pull origin main

      echo "Stopping any running containers..."
      docker-compose down

      echo "Building and starting containers..."
      docker-compose up --build -d

      echo "Running server-side tests..."
      docker exec moe-nodejs-app npm test || { echo "Server-side tests failed."; exit 1; }

      echo "Deployment completed successfully."
